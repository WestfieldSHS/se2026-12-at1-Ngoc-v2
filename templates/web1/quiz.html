<!-- Declares this document as HTML5 -->
<!doctype html>
<!-- Starts the HTML document in English -->
<html lang="en">
  <!-- Container for metadata and page settings -->
  <head>
    <!-- Sets the character encoding to UTF-8 -->
    <meta charset="UTF-8" />
    <!-- Ensures the page is responsive on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Sets the title shown in the browser tab -->
    <title>Filter Tutors</title>
    <!-- Links the external CSS file for styling -->
    <link rel="icon" href="/static/images/icon.png" type="image/png" />
    <!-- Tells the browser to use icon.png as the tab icon.-->
    <link rel="manifest" href="/static/manifest.json" />
    <!-- Tells the browser where to find PWA settings for install -->
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Closes the head section -->
  </head>

  <!-- Starts the visible content of the page -->
  <body>
    <!-- Top navigation bar container -->
    <header class="navbar">
      <!-- Displays the brand logo text -->
      <div class="logo">
        <img src="/static/images/icon.png" alt="TutorMatch Logo" height="50" />
      </div>
      <!-- Container for the search and filter tools -->
      <div class="search-bar">
        <!-- Dropdown that triggers a JavaScript filter function on change -->
        <select id="traitFilter" onchange="filterByTrait()">
          <!-- Default option to show all tutors -->
          <option value="">-- All Traits --</option>
          <!-- Starts a loop to display traits from the database -->
          {% for trait in traits %}
          <!-- Creates a dropdown option for each trait name -->
          <option value="{{ trait[1] }}">{{ trait[1] }}</option>
          <!-- Ends the trait loop -->
          {% endfor %}
          <!-- Closes the select dropdown -->
        </select>
        <!-- Closes the search-bar div -->
      </div>
      <!-- Closes the header section -->
    </header>

    <!-- Main content container for the tutor selection -->
    <main class="hero">
      <!-- Main page heading -->
      <h1>Select Your Tutor</h1>
      <!-- Instructions for filtering tutors -->
      <p>
        Pick a trait to filter. <strong>Tip:</strong> If you don't want a trait,
        select a different one.
      </p>

      <!-- Form that sends data to the final confirmation page -->
      <!-- Form starts: method must be POST for security (SE-12-07) and reliable offline use (SE-12-03) -->
      <form action="/final" method="POST">
        <!-- Form to send final selection -->
        <input type="hidden" name="fullname" value="{{ fullname }}" />
        <!-- Stores name -->
        <input type="hidden" name="email" value="{{ email }}" />
        <!-- Stores email -->
        <input type="hidden" name="username" value="{{ username }}" />
        <!-- Stores username -->
        <input type="hidden" name="password" value="{{ password }}" />
        <!-- Stores hashed PW -->
        <input type="hidden" name="course_id" value="{{ course_id }}" />
        <!-- THE FIX: Stores Course ID -->
        <input type="hidden" name="time" value="{{ time }}" />
        <!-- Stores time slot -->

        <div class="tutor-grid">
          <!-- Grid for tutors -->
          {% for tutor in tutors %}
          <!-- Loops through joined tutor data -->
          <div class="tutor-card" data-traits="{{ tutor['traits'] }}">
            <!-- Stores traits for JS filter -->
            <h3>{{ tutor['full_name'] }}</h3>
            <!-- Displays Name -->
            <p><strong>Learning Styles:</strong> {{ tutor['traits'] }}</p>
            <!-- Displays Traits -->
            <input
              type="radio"
              name="selected_tutor_id"
              value="{{ tutor['tutor_id'] }}"
              required
            />
            <!-- REMOVED THE DUPLICATE /> THAT WAS HERE -->
          </div>
          <!-- Ends card -->
          {% endfor %}
          <!-- Ends loop -->
        </div>
        <!-- Ends grid -->
        <button type="submit" class="btn">Confirm Registration</button>
        <!-- Submit button -->
      </form>
      <!-- Ends form -->
      <!-- Closes the main section -->
    </main>

    <!-- Bottom footer containing contact information -->
    <footer class="footer">
      <!-- Call to action for user questions -->
      <p>Not sure about something? <strong>Contact us!</strong></p>
      <!-- Specific phone and email contact details -->
      <p>Phone: 0400 000 000 | Email: info@tutors.com</p>
      <!-- Closes the footer section -->
    </footer>

    <!-- Starts the JavaScript section for page interactivity -->
    <script>
      // Defines the function to hide or show tutors based on traits
      function filterByTrait() {
        // Gets the currently selected trait from the dropdown menu
        let selectedTrait = document.getElementById("traitFilter").value;
        // Gets all elements on the page that are tutor cards
        let cards = document.getElementsByClassName("tutor-card");

        // Loops through every tutor card one by one
        for (let i = 0; i < cards.length; i++) {
          // Retrieves the traits string stored in the card's data attribute
          let tutorTraits = cards[i].getAttribute("data-traits");

          // Checks if the filter is empty or if the tutor has the selected trait
          if (selectedTrait === "" || tutorTraits.includes(selectedTrait)) {
            // Makes the card visible if it matches the criteria
            cards[i].style.display = "";
            // Runs if the tutor does not match the selected trait
          } else {
            // Hides the card from the user's view
            cards[i].style.display = "none";
            // Ends the if-else logic
          }
          // Ends the for loop
        }
        // Ends the filter function
      }
      // Ends the script section
    </script>

    <script>
      <!-- Starts the JavaScript section to register the background worker -->
      if ("serviceWorker" in navigator) {
        // Checks if the browser supports service workers
        navigator.serviceWorker
          .register("/service-worker.js") // Tells browser to activate your service worker file
          .then(function () {
            // Logic that runs if the registration is successful
            console.log("Service Worker registered successfully!"); // Prints success message to the browser console
          }) // Ends the success logic
          .catch(function (error) {
            // Logic that runs if there is an error during registration
            console.log("Service Worker registration failed:", error); // Prints the error details to the console
          }); // Ends the error logic
      } // Ends the browser check
    </script>
    <!-- Ends the service worker registration script -->
    <!-- Closes the body section -->
  </body>
  <!-- Closes the entire HTML document -->
</html>
